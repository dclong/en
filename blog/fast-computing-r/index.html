<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Write R Code that Runs Faster</title>
  <meta name="author" content="Ben Chuanlong Du">

  <link href="http://www.legendu.net/en/atom.xml" type="application/atom+xml" rel="alternate"
        title="Ben Chuanlong Du's Blog Atom Feed" />


  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="http://www.legendu.net/en/favicon.png" rel="icon">
  <link href="http://www.legendu.net/en/theme/css/main_2.css" media="screen, projection"
        rel="stylesheet" type="text/css">
  <script src="http://www.legendu.net/en/theme/js/modernizr-2.0.js"></script>
  <script src="http://www.legendu.net/en/theme/js/ender.js"></script>
  <script src="http://www.legendu.net/en/theme/js/octopress.js" type="text/javascript"></script>

  <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="http://www.legendu.net/en/">Ben Chuanlong Du's Blog</a></h1>
    <h2>And let it direct your passion with reason.</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://www.legendu.net/en/atom.xml" rel="subscribe-rss">RSS</a></li>
</ul>

<form name="search" action="https://www.bing.com/search" method="get" onSubmit="return build_query()">
  <fieldset role="search">
      <!--
    <input type="hidden" name="q" value="site:http://www.legendu.net/en" />
        -->
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<script type = "text/javascript">
    function build_query() {
        var query = document.forms["search"]["q"].value;
        var prefix = "site:http://www.legendu.net/en "
        if (!query.startsWith(prefix)) {
            query = prefix + query;
            document.forms["search"]["q"].value = query;
        }
        return true;
    }
</script>

<ul class="main-navigation">
    <li><a href="http://www.legendu.net">Home</a></li>
    <li><a href="http://www.legendu.net/en">Blog</a></li>
    <li><a href="http://www.legendu.net/en/archives.html">Archives</a></li>
    <li><a href="http://www.legendu.net/pages/about">About</a></li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Write R Code that Runs Faster</h1>
      <p class="meta"><time datetime="2015-08-26T22:08:17-07:00" pubdate>Aug 26, 2015</time></p>
</header>

  <div class="entry-content"><p><img src="http://dclong.github.io/media/r/run-fast.jpg" height="200" width="240" align="right"/></p>
<p>R is a popular statistical software which is famous for enormous amout of
packages. The syntax of R is very flexible with make it convenient at the cost
of performance. R is indeed slow compared to many other scripting languages, but
there are a few tricks which can make your R code run faster.</p>
<ol>
<li>
<p>Use vector and matrix operation if possible. Theses <code>*apply</code> functions
are very helpful for this purpose.</p>
</li>
<li>
<p>Avoid changing the type and size of object in R. Though we use R object
as if they are typeless, they have type actually. Changing the type and size
of a R object forces R to reallocate a memory space which is of course
ineffecient. I have seen so many people writing R code like </p>
<div class="highlight"><pre><span></span><span class="nv">s</span> <span class="o">=</span> <span class="nv">NULL</span>
<span class="k">while</span><span class="ss">(</span><span class="nv">condition</span><span class="ss">)</span>    
<span class="nv">s</span> <span class="o">=</span> <span class="nv">c</span><span class="ss">(</span><span class="nv">s</span>,<span class="nv">fun</span><span class="ss">())</span>
</pre></div>


</li>
</ol>
<p>or</p>
<div class="highlight"><pre><span></span>    <span class="n">s</span> <span class="o">=</span> <span class="n">rbind</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">fun</span><span class="p">())</span>
</pre></div>


<p>If you know the length of <code>s</code> ahead, it is better to allocate <code>s</code> as a
vector/list and access its elements in the loop instead of changing its
size. R coerces between different types of object implicitly whenever necessary.
For example, if you have a data frame with columns of the same type, 
you can do many matrix operations on it because R coerces the data frame to 
a matrix when needed. This is very inefficient especially when you have a large 
data frame. A better way is first convert the data frame to a matrix,
and then operate on the matrix. </p>
<ol>
<li>
<p>Use <code>foreach(i=1:n) %dopar% {}</code> to do parallel computing if applicable
(you check my another post on parallel computing). Even if a <code>for</code> loop is
not parallelizeable, <code>foreach(i=1:n) %do% {}</code> is a better alternative. </p>
</li>
<li>
<p>Use native code (e.g., Fortran, C/C++) for computationally intensive job if applicable. 
Though native code can increase the performance, there is overheading to invoke native code. 
It is less benefitial to invoke native code many times to do a smart part of job each time. 
You have to use command <code>R CMD SHLIB file_to_compile</code> to compile native code, 
and use the function <code>dyn.load</code> to load the shared library object. 
A more convenient way is to use R package "Rcpp" if you are confident about writing C++ code. 
However, you have to pay extra attention when you interact between R and other programming language. 
For example, passing arrays betwwen R and other languages can be tricky. 
For more information about this, refer to <a href="http://dclong.github.io/en/2012/05/r-interface-other-languages/">this post</a>.    </p>
</li>
<li>
<p>Split big data object (e.g., big data frame or matrix) to smaller ones,
and operate on these smaller objects.</p>
</li>
<li>
<p>Avoid creating too many objects in the each working environment. Not having
enough memeory can not only make your code run slower but also make it fail
to run if have to allocate big vectors. One way to do this is to writing
small functions and run your functions instead of running everything
directly in a working environment. Small functions make sure that objects
can be garbage collected quickly when they are no longer needed. If you leave them in
the working environment, they will never release memory seized. Partition
big work into smaller functions also helps reducing bugs. Aftering creating
and remove big data objects, you can also call the function <code>gc</code> manually to
collect garbage. </p>
</li>
<li>
<p>Use <code>double(n)</code> to create a vector of length <code>n</code> instead of using code
<code>rep(0,n)</code>, and similar for others.</p>
</li>
<li>
<p>Use matrix instead of data frame wheneve possible. Actually data frame
cause problem in many cases. Only use data frame when necessary.</p>
</li>
<li>
<p>to be continued ...</p>
</li>
</ol></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">Ben Chuanlong Du</span>
  </span>
<time datetime="2015-08-26T22:08:17-07:00" pubdate>Aug 26, 2015</time>  <span class="categories">
    <a class="category" href="http://www.legendu.net/en/tag/dll.html">DLL</a>
    <a class="category" href="http://www.legendu.net/en/tag/programming.html">programming</a>
    <a class="category" href="http://www.legendu.net/en/tag/hpc.html">HPC</a>
    <a class="category" href="http://www.legendu.net/en/tag/high-performance-computing.html">high performance computing</a>
    <a class="category" href="http://www.legendu.net/en/tag/parallel.html">parallel</a>
    <a class="category" href="http://www.legendu.net/en/tag/r.html">R</a>
    <a class="category" href="http://www.legendu.net/en/tag/memory.html">memory</a>
    <a class="category" href="http://www.legendu.net/en/tag/gc.html">GC</a>
    <a class="category" href="http://www.legendu.net/en/tag/speedup.html">speedup</a>
    <a class="category" href="http://www.legendu.net/en/tag/fast.html">fast</a>
    <a class="category" href="http://www.legendu.net/en/tag/cran.html">CRAN</a>
  </span>
</p>    </footer>
  </article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
  </section>
</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="http://www.legendu.net/en/blog/runtime-paths-in-python/">Runtime Paths in Python</a>
      </li>
      <li class="post">
          <a href="http://www.legendu.net/en/blog/configuration-scripts-for-the-blog-project-on-notebooks.ai/">Configuration Scripts for the Blog Project on Notebooks.Ai</a>
      </li>
      <li class="post">
          <a href="http://www.legendu.net/en/blog/string-in-python/">String in Python</a>
      </li>
      <li class="post">
          <a href="http://www.legendu.net/en/blog/my-docker-images/">My Docker Images</a>
      </li>
      <li class="post">
          <a href="http://www.legendu.net/en/blog/docker-image-and-container-management/">Manage Docker Images and Containers</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="http://www.legendu.net/en/category/apple.html">Apple</a></li>
        <li><a href="http://www.legendu.net/en/category/fun-problems.html">Fun Problems</a></li>
        <li><a href="http://www.legendu.net/en/category/internet.html">internet</a></li>
        <li><a href="http://www.legendu.net/en/category/linux.html">Linux</a></li>
        <li><a href="http://www.legendu.net/en/category/network.html">Network</a></li>
        <li><a href="http://www.legendu.net/en/category/os.html">OS</a></li>
        <li><a href="http://www.legendu.net/en/category/programming.html">Programming</a></li>
        <li><a href="http://www.legendu.net/en/category/research.html">Research</a></li>
        <li><a href="http://www.legendu.net/en/category/software.html">Software</a></li>
        <li><a href="http://www.legendu.net/en/category/statistics.html">Statistics</a></li>
        <li><a href="http://www.legendu.net/en/category/work.html">Work</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
  <p class="tagcloud">
  </p>
  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/dclong">@dclong</a> on GitHub
    <script type="text/javascript">
      $.domReady(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = 'http://www.legendu.net/en/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'dclong',
              count: 3,
              skip_forks: true,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="http://www.legendu.net/en/theme/js/github.js" type="text/javascript"> </script>
  </section>

    <section>
        <h1>Social</h2>
        <ul>
            <li><a href="https://www.linkedin.com/in/ben-chuanlong-du-1239b221/" target="_blank">LinkedIn</a></li>
            <li><a href="https://twitter.com/longendu" target="_blank">Twitter</a></li>
            <li><a href="https://www.facebook.com/chuanlong.du" target="_blank">Facebook</a></li>
        <!--
            <li><a href="http://www.legendu.net/en/" type="application/rss+xml" rel="alternate">RSS</a></li>
            -->
        </ul>
    </section>
</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Ben Chuanlong Du -
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-30259661-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
	<script type="text/javascript">
	  var disqus_shortname = 'dclong';
          var disqus_identifier = '/blog/fast-computing-r/';
          var disqus_url = 'http://www.legendu.net/en/blog/fast-computing-r/';
          var disqus_title = 'Write R Code that Runs Faster';
	  (function() {
	    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	   })();
	</script>
</body>
</html>